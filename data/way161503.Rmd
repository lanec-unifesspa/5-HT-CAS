---
title: "R Notebook for effects of WAY-163909 on zebrafish alarm responses (LaNeC)"
author:
- Caio Maximino^[Universidade Federal do Sul e Sudeste do Pará]
- Monica Gomes Lima-Maximino^[Universidade do Estado do Pará]
- Rhayra Xavier do Carmo Silva^[Universidade Federal do Pará]

output:
  github_document 

subtitle: From project "Role of serotonin on behavioral responses to alarm substance in zebrafish: A putative model for panic disorder"
tags:
- panic disorder
- zebrafish
- WAY-163909
abstract: |
  Behavioral data in the novel tank test during and after conspecific alarm substance (CAS) exposure using WAY-163909 in zebrafish
---

This is an [R Markdown](http://rmarkdown.rstudio.com) Notebook. When you execute code within the notebook, the results appear beneath the code. 

Try executing this chunk by clicking the *Run* button within the chunk or by placing your cursor inside it and pressing *Ctrl+Shift+Enter*. 

Data is produced by members from Laboratório de Neurociências e Comportamento "Frederico Guilherme Graeff", affiliated to Universidade Federal do Sul e Sudeste do Pará and Universidade do Estado do Pará. The package will include primary data for a behavioral experiment on the effects of WAY-163909 on zebrafish fear-like behavior. In Experiment 1, behavior during exposure was tested; in Experiment 2, behavior after exposure was tested.

* Load needed libraries
```{r}
if(!require(ggplot2)){
    install.packages("ggplot2")
    library(ggplot2)
}

if(!require(RCurl)){
    install.packages("RCurl")
    library(RCurl)
}

if(!require(plyr)){
    install.packages("plyr")
    library(plyr)
}

if(!require(rcompanion)){
    install.packages("rcompanion")
    library(rcompanion)
}

if(!require(WRS2)){
    install.packages("WRS2")
    library(WRS2)
}

if(!require(psych)){
    install.packages("psych")
    library(psych)
}

if(!require(stats)){
    install.packages("stats")
    library(stats)
}

if(!require(sjstats)){
    install.packages("sjstats")
    library(sjstats)
}

if(!require(multcompView)){
    install.packages("multcompView")
    library(multcompView)
}
```

* Load data

```{r}
x1 <- getURL("https://raw.githubusercontent.com/lanec-unifesspa/5-HT-CAS/master/data/WAY163909/way_during.csv")
way_during <- read.csv(text = x1)
way_during$Treatment <- factor(way_during$Treatment, levels = c("CTRL", "CAS"))
way_during$Drug <- as.factor(way_during$Drug)
View(way_during)

x2 <- getURL("https://raw.githubusercontent.com/lanec-unifesspa/5-HT-CAS/master/data/WAY163909/way_after.csv")
way_after <- read.csv(text = x2)
way_after$Treatment <- factor(way_after$Treatment, levels = c("CTRL", "CAS"))
way_after$Drug <- as.factor(way_after$Drug)
View(way_after)
```

* Detect outliers (based on time on bottom during exposure) and remove them, using a 3.5xMAD rule
```{r}
gA <- way_during[c(1:10), ]
median(gA$Time.Bottom) + 3.5*mad(gA$Time.Bottom)
median(gA$Time.Bottom) - 3.5*mad(gA$Time.Bottom)
#Subjects A2 and A16 identified as outlier; remove

gB <- way_during[c(11:20), ]
median(gB$Time.Bottom) + 3.5*mad(gB$Time.Bottom)
median(gB$Time.Bottom) - 3.5*mad(gB$Time.Bottom)

gC <- way_during[c(21:30), ]
median(gC$Time.Bottom) + 3.5*mad(gC$Time.Bottom)
median(gC$Time.Bottom) - 3.5*mad(gC$Time.Bottom)


gD <- way_during[c(31:39), ]
median(gD$Time.Bottom) + 3.5*mad(gD$Time.Bottom)
median(gD$Time.Bottom) - 3.5*mad(gD$Time.Bottom)
#No outliers
```

* Run ANOVA for main and interaction effects on 2-way ANOVA, for Experiment 1

1) Time on top
1.1) Analysis
```{r}
anova.tt.during <- aov(Time.Top ~ Treatment + Dose + Treatment:Dose, data = way_during) #run type I ANOVA
summary(anova.tt.during) #summarize ANOVA results
omega_sq(anova.tt.during) #Calculate effect size (omega-squared)
cohens_f(anova.tt.during) #Calculate effect size (Cohen's f-squared)
PTTT_during <- TukeyHSD(anova.tt.during) #run Tukey's HSD post-hoc test)
multcompLetters(PTTT_during$`Treatment:Dose`[,'p adj']) #Visualize results from post-test as letters
```

1.2) Graphics
```{r}
TTInt <- ddply(way_during, .(Drug, Treatment), summarise, val = mean(Time.Top))
ggplot(way_during, aes(x = factor(Drug), y = Time.Top, colour = Treatment)) + geom_boxplot(outlier.shape = NA) + geom_point(data = TTInt, aes(y = val, group = Treatment), position = position_dodge(width = 0.75)) + ylim(0, 360) + geom_line(data = TTInt, aes(y = val, group = Treatment), position = position_dodge(width = 0.75)) + geom_jitter(position = "dodge", alpha = 0.3) + geom_hline(yintercept = 120, linetype = "dashed", color = "gray") + labs(x = "Drug", y = "Time on top (s)", color = "Treatment") + scale_colour_brewer(palette = "Set1") + theme_bw() +  annotate(geom = "text", x = 1.8, y = 240, label = "b") + annotate(geom = "text", x = 2.2, y = 75, label = "a") + annotate(geom = "text", x = 2.8, y = 120, label = "ab") + annotate(geom = "text", x = 3.2, y = 120, label = "ab")
```

2) Time on bottom
2.1) Analysis
```{r}
anova.tb.during <- aov(Time.Bottom ~ Treatment + Dose + Treatment:Dose, data = way_during) #run type I ANOVA
summary(anova.tb.during) #summarize ANOVA results
omega_sq(anova.tb.during) #Calculate effect size (omega-squared)
cohens_f(anova.tb.during) #Calculate effect size (Cohen's f-squared)
PTTB_during <- TukeyHSD(anova.tb.during) #run Tukey's HSD post-hoc test)
multcompLetters(PTTB_during$`Treatment:Dose`[,'p adj']) #Visualize results from post-test as letters
```

2.2) Graphics
```{r}
TBInt <- ddply(way_during, .(Drug, Treatment), summarise, val = mean(Time.Bottom))
ggplot(way_during, aes(x = factor(Drug), y = Time.Bottom, colour = Treatment)) + geom_boxplot(outlier.shape = NA) + geom_point(data = TBInt, aes(y = val, group = Treatment), position = position_dodge(width = 0.75)) + ylim(0, 360) + geom_line(data = TBInt, aes(y = val, group = Treatment), position = position_dodge(width = 0.75)) + geom_jitter(position = "dodge", alpha = 0.3) + geom_hline(yintercept = 120, linetype = "dashed", color = "gray") + labs(x = "Drug", y = "Time on bottom (s)", color = "Treatment") + scale_colour_brewer(palette = "Set1") + theme_bw()
```

3) Erratic swimming
3.1) Analysis
```{r}
anova.es.during <- aov(AbsoluteTurnAngle ~ Treatment + Dose + Treatment:Dose, data = way_during) #run type I ANOVA
summary(anova.es.during) #summarize ANOVA results
omega_sq(anova.e.during) #Calculate effect size (omega-squared)
cohens_f(anova.es.during) #Calculate effect size (Cohen's f-squared)
PTES_during <- TukeyHSD(anova.es.during) #run Tukey's HSD post-hoc test)
multcompLetters(PTES_during$`Treatment:Dose`[,'p adj']) #Visualize results from post-test as letters
```

3.2) Graphics
```{r}
ESInt <- ddply(way_during, .(Drug, Treatment), summarise, val = mean(AbsoluteTurnAngle))
ggplot(way_during, aes(x = factor(Drug), y = AbsoluteTurnAngle, colour = Treatment)) + geom_boxplot(outlier.shape = NA) + geom_point(data = ESInt, aes(y = val, group = Treatment), position = position_dodge(width = 0.75)) + geom_line(data = ESInt, aes(y = val, group = Treatment), position = position_dodge(width = 0.75)) + geom_jitter(position = "dodge", alpha = 0.3) + labs(x = "Drug", y = "Erratic swimming (Abs. Turn Angle)", color = "Treatment") + scale_colour_brewer(palette = "Set1") + theme_bw()
```

4) Freezing
4.1) Analysis
```{r}
anova.fr.during <- aov(Freezing.S ~ Treatment + Dose + Treatment:Dose, data = way_during) #run type I ANOVA
summary(anova.fr.during) #summarize ANOVA results
omega_sq(anova.fr.during) #Calculate effect size (omega-squared)
cohens_f(anova.fr.during) #Calculate effect size (Cohen's f-squared)
PTFR_during <- TukeyHSD(anova.fr.during) #run Tukey's HSD post-hoc test)
multcompLetters(PTFR_during$`Treatment:Dose`[,'p adj']) #Visualize results from post-test as letters
```

4.2) Graphics
```{r}
FrNInt <- ddply(way_during, .(Drug, Treatment), summarise, val = mean(Freezing.N))
ggplot(way_during, aes(x = factor(Drug), y = Freezing.N, colour = Treatment)) + geom_boxplot(outlier.shape = NA) + geom_point(data = FrNInt, aes(y = val, group = Treatment), position = position_dodge(width = 0.75)) + geom_line(data = FrNInt, aes(y = val, group = Treatment), position = position_dodge(width = 0.75)) + geom_jitter(position = "dodge", alpha = 0.3) + labs(x = "Drug", y = "Freezing (s)", color = "Treatment") + scale_colour_brewer(palette = "Set1") + theme_bw()
```

5) Speed
5.1) Analysis
```{r}
anova.sp.during <- aov(Time.Top ~ Treatment + Dose + Treatment:Dose, data = way_during) #run type I ANOVA
summary(anova.sp.during) #summarize ANOVA results
omega_sq(anova.sp.during) #Calculate effect size (omega-squared)
cohens_f(anova.sp.during) #Calculate effect size (Cohen's f-squared)
PTSP_during <- TukeyHSD(anova.sp.during) #run Tukey's HSD post-hoc test)
multcompLetters(PTSP_during$`Treatment:Dose`[,'p adj']) #Visualize results from post-test as letters
```

5.2) Graphics
```{r}
SpInt <- ddply(way_during, .(Dose, Treatment), summarise, val = mean(Speed))
ggplot(way_during, aes(x = factor(Dose), y = Squares, colour = Treatment)) + geom_boxplot(outlier.shape = NA) + geom_point(data = SpInt, aes(y = val, group = Treatment), position = position_dodge(width = 0.75)) + geom_line(data = SqrInt, aes(y = val, group = Treatment), position = position_dodge(width = 0.75)) + geom_jitter(position = "dodge", alpha = 0.3) + labs(x = "Drug", y = "Speed (cm/s)", color = "Treatment") + scale_colour_brewer(palette = "Set1") + theme_bw()
```

* Run ANOVA for main and interaction effects on 2-way ANOVA, for data after exposure

1) Time on top
1.1) Analysis
```{r}
anova.tt.after <- aov(Time.Top ~ Treatment + Dose + Treatment:Dose, data = way_after) #run type I ANOVA
summary(anova.tt.after) #summarize ANOVA results
omega_sq(anova.tt.after) #Calculate effect size (omega-squared)
cohens_f(anova.tt.after) #Calculate effect size (Cohen's f-squared)
PTTT_after <- TukeyHSD(anova.tt.after) #run Tukey's HSD post-hoc test)
multcompLetters(PTTT_after$`Treatment:Dose`[,'p adj']) #Visualize results from post-test as letters
```

1.2) Graphics
```{r}
TTAfter <- ddply(way_after, .(Dose, Treatment), summarise, val = mean(Time.Top))
ggplot(way_after, aes(x = factor(Dose), y = Time.Top, colour = Treatment)) + geom_boxplot(outlier.shape = NA) + geom_point(data = TTAfter, aes(y = val, group = Treatment), position = position_dodge(width = 0.75)) + geom_line(data = TTAfter, aes(y = val, group = Treatment), position = position_dodge(width = 0.75)) + geom_jitter(position = "dodge", alpha = 0.3) + geom_hline(yintercept = 120, linetype = "dashed", color = "gray") + labs(x = "Drug", y = "Time on top (s)", color = "Treatment") + scale_colour_brewer(palette = "Accent") + theme_bw()
```

2) Time on bottom
2.1) Analysis
```{r}
anova.tb.after <- aov(Time.Bottom ~ Treatment + Dose + Treatment:Dose, data = way_after) #run type I ANOVA
summary(anova.tb.after) #summarize ANOVA results
omega_sq(anova.tb.after) #Calculate effect size (omega-squared)
cohens_f(anova.tb.after) #Calculate effect size (Cohen's f-squared)
PTTB_after <- TukeyHSD(anova.tb.after) #run Tukey's HSD post-hoc test)
multcompLetters(PTTB_after$`Treatment:Dose`[,'p adj']) #Visualize results from post-test as letters
```

2.2) Graphics
```{r}
TBAfter <- ddply(way_after, .(Dose, Treatment), summarise, val = mean(Time.Bottom))
ggplot(way_after, aes(x = factor(Dose), y = Time.Bottom, colour = Treatment)) + ylim(0, 360) + geom_boxplot(outlier.shape = NA) + geom_point(data = TBAfter, aes(y = val, group = Treatment), position = position_dodge(width = 0.75)) + geom_line(data = TBAfter, aes(y = val, group = Treatment), position = position_dodge(width = 0.75)) + geom_jitter(position = "dodge", alpha = 0.3) + geom_hline(yintercept = 120, linetype = "dashed", color = "gray") + labs(x = "Drug", y = "Time on bottom (s)", color = "Treatment") + scale_colour_brewer(palette = "Accent") + theme_bw()
```

3) Erratic swimming
3.1) Analysis
```{r}
anova.es.after <- aov(AbsoluteTurnAngle ~ Treatment + Dose + Treatment:Dose, data = way_after) #run type I ANOVA
summary(anova.es.after) #summarize ANOVA results
omega_sq(anova.es.after) #Calculate effect size (omega-squared)
cohens_f(anova.es.after) #Calculate effect size (Cohen's f-squared)
PTES_after <- TukeyHSD(anova.es.after) #run Tukey's HSD post-hoc test)
multcompLetters(PTES_after$`Treatment:Dose`[,'p adj']) #Visualize results from post-test as letters
```

3.2) Graphics
```{r}
ESAfter <- ddply(way_after, .(Dose, Treatment), summarise, val = mean(AbsoluteTurnAngle))
ggplot(way_after, aes(x = factor(Dose), y = AbsoluteTurnAngle, colour = Treatment)) + geom_boxplot(outlier.shape = NA) + geom_point(data = ESAfter, aes(y = val, group = Treatment), position = position_dodge(width = 0.75)) + geom_line(data = ESAfter, aes(y = val, group = Treatment), position = position_dodge(width = 0.75)) + geom_jitter(position = "dodge", alpha = 0.3) + labs(x = "Drug", y = "Erratic swimming (Abs. Turn Angle)", color = "Treatment") + scale_colour_brewer(palette = "Accent") + theme_bw()
```

4) Freezing
4.1) Analysis
```{r}
anova.fr.after <- aov(Freezing.S ~ Treatment + Dose + Treatment:Dose, data = way_after) #run type I ANOVA
summary(anova.fr.after) #summarize ANOVA results
omega_sq(anova.fr.after) #Calculate effect size (omega-squared)
cohens_f(anova.fr.after) #Calculate effect size (Cohen's f-squared)
PTFR_after <- TukeyHSD(anova.fr.after) #run Tukey's HSD post-hoc test)
multcompLetters(PTFR_after$`Treatment:Dose`[,'p adj']) #Visualize results from post-test as letters
```

4.2) Graphics
```{r}
FrAfter <- ddply(way_after, .(Dose, Treatment), summarise, val = mean(Freezing.S))
ggplot(way_after, aes(x = factor(Dose), y = Freezing.S, colour = Treatment)) + geom_boxplot(outlier.shape = NA) + geom_point(data = FrAfter, aes(y = val, group = Treatment), position = position_dodge(width = 0.75)) + geom_line(data = FrAfter, aes(y = val, group = Treatment), position = position_dodge(width = 0.75)) + geom_jitter(position = "dodge", alpha = 0.3) + labs(x = "Drug", y = "Freezing (s)", color = "Treatment") + scale_colour_brewer(palette = "Accent") + theme_bw()
```

5) Speed
5.1) Analysis
```{r}
anova.sp.after <- aov(Speed ~ Treatment + Dose + Treatment:Dose, data = way_after) #run type I ANOVA
summary(anova.sp.after) #summarize ANOVA results
omega_sq(anova.sp.after) #Calculate effect size (omega-squared)
cohens_f(anova.sp.after) #Calculate effect size (Cohen's f-squared)
PTSP_after <- TukeyHSD(anova.sp.after) #run Tukey's HSD post-hoc test)
multcompLetters(PTSP_after$`Treatment:Dose`[,'p adj']) #Visualize results from post-test as letters
```

5.2) Graphics
```{r}
SpAfter <- ddply(way_after, .(Dose, Treatment), summarise, val = mean(Speed))
ggplot(way_after, aes(x = factor(Dose), y = Speed, colour = Treatment)) + geom_boxplot(outlier.shape = NA) + geom_point(data = SpAfter, aes(y = val, group = Treatment), position = position_dodge(width = 0.75)) + geom_line(data = SpAfter, aes(y = val, group = Treatment), position = position_dodge(width = 0.75)) + geom_jitter(position = "dodge", alpha = 0.3) + labs(x = "Drug", y = "Speed (cm/s)", color = "Treatment") + scale_colour_brewer(palette = "Accent") + theme_bw()
```

6) Thrashing
6.1) Analysis
```{r}
anova.thr.after <- aov(Thrashing ~ Treatment + Drug + Treatment:Drug, data = way_after)
summary(anova.thr.after)
TukeyHSD(anova.thr.after)
```

6.2) Graphics
```{r}
ThrAfter <- ddply(way_after, .(Drug, Treatment), summarise, val = mean(Thrashing))
ggplot(way_after, aes(x = factor(Drug), y = Thrashing, colour = Treatment)) + geom_boxplot(outlier.shape = NA) + geom_point(data = ThrAfter, aes(y = val, group = Treatment), position = position_dodge(width = 0.75)) + geom_line(data = ThrAfter, aes(y = val, group = Treatment), position = position_dodge(width = 0.75)) + geom_jitter(position = "dodge", alpha = 0.3) + labs(x = "Drug", y = "Thrashing (N)", color = "Treatment") + scale_colour_brewer(palette = "Accent") + theme_bw()
```

7) Squares crossed
7.1) Analysis
```{r}
anova.sqr.after <- aov(Squares ~ Treatment + Drug + Treatment:Drug, data = way_after)
summary(anova.sqr.after)
TukeyHSD(anova.sqr.after)
```

7.2) Graphics
```{r}
SqrAfter <- ddply(way_after, .(Drug, Treatment), summarise, val = mean(Squares))
ggplot(way_after, aes(x = factor(Drug), y = Squares, colour = Treatment)) + geom_boxplot(outlier.shape = NA) + geom_point(data = SqrAfter, aes(y = val, group = Treatment), position = position_dodge(width = 0.75)) + geom_line(data = SqrAfter, aes(y = val, group = Treatment), position = position_dodge(width = 0.75)) + geom_jitter(position = "dodge", alpha = 0.3) + labs(x = "Drug", y = "Squares crossed (N)", color = "Treatment") + scale_colour_brewer(palette = "Accent") + theme_bw()
```